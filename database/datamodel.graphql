enum Role {
  WORKSPACE_ADMIN
  WORKSPACE_EDITOR
  WORKSPACE_VIEWER
  DEPLOYMENT_ADMIN
  DEPLOYMENT_EDITOR
  DEPLOYMENT_VIEWER
  SYSTEM_ADMIN
  SYSTEM_EDITOR
  SYSTEM_VIEWER
}

type User {
  id: ID! @unique
  username: String @unique
  status: String
  fullName: String
  avatarUrl: String
  emails: [Email!]!
  roleBindings: [RoleBinding!]!
  inviteTokens: [InviteToken!]!
  localCredential: LocalCredential
  oauthCredentials: [OAuthCredential!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# Ideally this type uses a union type once prisma supports it.
# subject: User | ServiceAccount
# principal: Workspace | Deployment
# https://github.com/prisma/prisma/issues/165
type RoleBinding {
  id: ID! @unique
  role: Role
  user: User
  serviceAccount: ServiceAccount
  workspace: Workspace
  deployment: Deployment
}

type Email {
  id: ID! @unique
  address: String @unique
  primary: Boolean
  token: String @unique
  user: User
  verified: Boolean
}

type LocalCredential {
  id: ID! @unique
  user: User
  password: String @unique
  resetToken: String
}

type OAuthCredential {
  id: ID! @unique
  expiresAt: DateTime
  oauthProvider: String!
  oauthUserId: String!
  user: User
}


type InviteToken {
  id: ID! @unique
  email: String
  token: String
  workspace: Workspace
  createdAt: DateTime!
  updatedAt: DateTime!
}

type ServiceAccount {
  id: ID! @unique
  apiKey: String
  label: String
  category: String
  active: Boolean
  roleBinding: RoleBinding
  lastUsedAt: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Workspace {
  id: ID! @unique
  active: Boolean
  deployments: [Deployment!]!
  description: String
  invites: [InviteToken!]!
  label: String
  properties: [WorkspaceProperty!]!
  roleBindings: [RoleBinding!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type WorkspaceProperty {
  id: ID! @unique
  category: String
  key: String!
  value: String
  workspace: Workspace
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Deployment {
  id: ID! @unique
  config: Json
  properties: [DeploymentProperty!]!
  description: String
  label: String
  registryPassword: String
  releaseName: String @unique
  status: String
  type: String
  version: String
  workspace: Workspace
  createdAt: DateTime!
  updatedAt: DateTime!
}

type DeploymentProperty {
  id: ID! @unique
  category: String
  deployment: Deployment
  key: String!
  value: String
  createdAt: DateTime!
  updatedAt: DateTime!
}
